jQuery&&function(t){t.extend(t.fn,{miniColors:function(a,o){var r=function(a,o,r){var n=C(a.val());n||(n="ffffff");var e=P(n),c=t('<a class="miniColors-trigger" style="background-color: #'+n+'" href="#"></a>');c.insertAfter(a),a.addClass("miniColors").data("original-maxlength",a.attr("maxlength")||null).data("original-autocomplete",a.attr("autocomplete")||null).data("letterCase","uppercase").data("trigger",c).data("hsb",e).data("change",o.change?o.change:null).attr("maxlength",7).attr("autocomplete","off").val("#"+g(n,o.letterCase)),o.readonly&&a.prop("readonly",!0),o.disabled&&i(a),c.bind("click.miniColors",function(t){t.preventDefault(),""===a.val()&&a.val("#"),s(a)}),a.bind("focus.miniColors",function(t){""===a.val()&&a.val("#"),s(a)}),a.bind("blur.miniColors",function(t){var o=C(a.val());a.val(o?"#"+g(o,a.data("letterCase")):"")}),a.bind("keydown.miniColors",function(t){9===t.keyCode&&l(a)}),a.bind("keyup.miniColors",function(t){f(a)}),a.bind("paste.miniColors",function(t){setTimeout(function(){f(a)},5)})},n=function(a){l(),(a=t(a)).data("trigger").remove(),a.attr("autocomplete",a.data("original-autocomplete")).attr("maxlength",a.data("original-maxlength")).removeData().removeClass("miniColors").unbind(".miniColors"),t(document).unbind(".miniColors")},e=function(t){t.prop("disabled",!1).data("trigger").css("opacity",1)},i=function(t){l(t),t.prop("disabled",!0).data("trigger").css("opacity",.5)},s=function(a){if(a.prop("disabled"))return!1;l();var o=t('<div class="miniColors-selector"></div>');o.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').css({top:a.is(":visible")?a.offset().top+a.outerHeight():a.data("trigger").offset().top+a.data("trigger").outerHeight(),left:a.is(":visible")?a.offset().left:a.data("trigger").offset().left,display:"none"}).addClass(a.attr("class"));var r=a.data("hsb");o.find(".miniColors-colors").css("backgroundColor","#"+M({h:r.h,s:100,b:100}));var n=a.data("colorPosition");n||(n=v(r)),o.find(".miniColors-colorPicker").css("top",n.y+"px").css("left",n.x+"px");var e=a.data("huePosition");e||(e=m(r)),o.find(".miniColors-huePicker").css("top",e.y+"px"),a.data("selector",o).data("huePicker",o.find(".miniColors-huePicker")).data("colorPicker",o.find(".miniColors-colorPicker")).data("mousebutton",0),t("BODY").append(o),o.fadeIn(100),o.bind("selectstart",function(){return!1}),t(document).bind("mousedown.miniColors touchstart.miniColors",function(o){a.data("mousebutton",1),t(o.target).parents().andSelf().hasClass("miniColors-colors")&&(o.preventDefault(),a.data("moving","colors"),c(a,o)),t(o.target).parents().andSelf().hasClass("miniColors-hues")&&(o.preventDefault(),a.data("moving","hues"),u(a,o)),t(o.target).parents().andSelf().hasClass("miniColors-selector")?o.preventDefault():t(o.target).parents().andSelf().hasClass("miniColors")||l(a)}),t(document).bind("mouseup.miniColors touchend.miniColors",function(t){t.preventDefault(),a.data("mousebutton",0).removeData("moving")}).bind("mousemove.miniColors touchmove.miniColors",function(t){t.preventDefault(),1===a.data("mousebutton")&&("colors"===a.data("moving")&&c(a,t),"hues"===a.data("moving")&&u(a,t))})},l=function(a){a||(a=".miniColors"),t(a).each(function(){var a=t(this).data("selector");t(this).removeData("selector"),t(a).fadeOut(100,function(){t(this).remove()})}),t(document).unbind(".miniColors")},c=function(t,a){var o=t.data("colorPicker");o.hide();var r={x:a.pageX,y:a.pageY};a.originalEvent.changedTouches&&(r.x=a.originalEvent.changedTouches[0].pageX,r.y=a.originalEvent.changedTouches[0].pageY),r.x=r.x-t.data("selector").find(".miniColors-colors").offset().left-5,r.y=r.y-t.data("selector").find(".miniColors-colors").offset().top-5,r.x<=-5&&(r.x=-5),r.x>=144&&(r.x=144),r.y<=-5&&(r.y=-5),r.y>=144&&(r.y=144),t.data("colorPosition",r),o.css("left",r.x).css("top",r.y).show();var n=Math.round(.67*(r.x+5));n<0&&(n=0),n>100&&(n=100);var e=100-Math.round(.67*(r.y+5));e<0&&(e=0),e>100&&(e=100);var i=t.data("hsb");i.s=n,i.b=e,d(t,i,!0)},u=function(t,a){var o=t.data("huePicker");o.hide();var r={y:a.pageY};a.originalEvent.changedTouches&&(r.y=a.originalEvent.changedTouches[0].pageY),r.y=r.y-t.data("selector").find(".miniColors-colors").offset().top-1,r.y<=-1&&(r.y=-1),r.y>=149&&(r.y=149),t.data("huePosition",r),o.css("top",r.y).show();var n=Math.round(2.4*(150-r.y-1));n<0&&(n=0),n>360&&(n=360);var e=t.data("hsb");e.h=n,d(t,e,!0)},d=function(t,a,o){t.data("hsb",a);var r=M(a);if(o&&t.val("#"+g(r,t.data("letterCase"))),t.data("trigger").css("backgroundColor","#"+r),t.data("selector")&&t.data("selector").find(".miniColors-colors").css("backgroundColor","#"+M({h:a.h,s:100,b:100})),t.data("change")){if(r===t.data("lastChange"))return;t.data("change").call(t.get(0),"#"+r,b(a)),t.data("lastChange",r)}},f=function(a){a.val("#"+p(a.val()));var o=C(a.val());if(!o)return!1;var r=P(o),n=a.data("hsb");if(r.h===n.h&&r.s===n.s&&r.b===n.b)return!0;var e=v(r);t(a.data("colorPicker")).css("top",e.y+"px").css("left",e.x+"px"),a.data("colorPosition",e);var i=m(r);return t(a.data("huePicker")).css("top",i.y+"px"),a.data("huePosition",i),d(a,r),!0},g=function(t,a){return"lowercase"===a?t.toLowerCase():"uppercase"===a?t.toUpperCase():t},v=function(t){var a=Math.ceil(t.s/.67);a<0&&(a=0),a>150&&(a=150);var o=150-Math.ceil(t.b/.67);return o<0&&(o=0),o>150&&(o=150),{x:a-5,y:o-5}},m=function(t){var a=150-t.h/2.4;return a<0&&(h=0),a>150&&(h=150),{y:a-1}},p=function(t){return t.replace(/[^A-F0-9]/gi,"")},C=function(t){return(t=p(t))?(3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),6===t.length?t:null):null},b=function(t){var a={},o=Math.round(t.h),r=Math.round(255*t.s/100),n=Math.round(255*t.b/100);if(0===r)a.r=a.g=a.b=n;else{var e=n,i=(255-r)*n/255,s=o%60*(e-i)/60;360===o&&(o=0),o<60?(a.r=e,a.b=i,a.g=i+s):o<120?(a.g=e,a.b=i,a.r=e-s):o<180?(a.g=e,a.r=i,a.b=i+s):o<240?(a.b=e,a.r=i,a.g=e-s):o<300?(a.b=e,a.g=i,a.r=i+s):o<360?(a.r=e,a.g=i,a.b=e-s):(a.r=0,a.g=0,a.b=0)}return{r:Math.round(a.r),g:Math.round(a.g),b:Math.round(a.b)}},y=function(a){var o=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];return t.each(o,function(t,a){1===a.length&&(o[t]="0"+a)}),o.join("")},x=function(t){return t=parseInt(t.indexOf("#")>-1?t.substring(1):t,16),{r:t>>16,g:(65280&t)>>8,b:255&t}},k=function(t){var a={h:0,s:0,b:0},o=Math.min(t.r,t.g,t.b),r=Math.max(t.r,t.g,t.b),n=r-o;return a.b=r,a.s=0!==r?255*n/r:0,0!==a.s?t.r===r?a.h=(t.g-t.b)/n:t.g===r?a.h=2+(t.b-t.r)/n:a.h=4+(t.r-t.g)/n:a.h=-1,a.h*=60,a.h<0&&(a.h+=360),a.s*=100/255,a.b*=100/255,a},P=function(t){var a=k(x(t));return 0===a.s&&(a.h=360),a},M=function(t){return y(b(t))};switch(a){case"readonly":return t(this).each(function(){t(this).hasClass("miniColors")&&t(this).prop("readonly",o)}),t(this);case"disabled":return t(this).each(function(){t(this).hasClass("miniColors")&&(o?i(t(this)):e(t(this)))}),t(this);case"value":if(void 0===o){if(!t(this).hasClass("miniColors"))return;var D=t(this),w=C(D.val());return w?"#"+g(w,D.data("letterCase")):null}return t(this).each(function(){t(this).hasClass("miniColors")&&(t(this).val(o),f(t(this)))}),t(this);case"destroy":return t(this).each(function(){t(this).hasClass("miniColors")&&n(t(this))}),t(this);default:return a||(a={}),t(this).each(function(){"input"===t(this)[0].tagName.toLowerCase()&&(t(this).data("trigger")||r(t(this),a))}),t(this)}}})}(jQuery);
